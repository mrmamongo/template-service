# Template Service üöÄ

#### –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–π —Å—Ç–µ–∫:

üêç Python3.11  
üêç FastAPI  
üêç SQLAlchemy2  
üêç Dishka
üêç Adaptix
üêç Pytest
üè∑Ô∏è Postgres

----------------------  

# üìó 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞

## –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

–î–ª—è —ç—Ç–æ–≥–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª .env.example –≤ .env

```bash
cp example.env env
```

### –û–ø–∏—Å–∞–Ω–∏–µ ENV –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ |      
|------------|----------|

–ü—Ä–∏–º–µ—Ä—ã –∑–Ω–∞—á–µ–Ω–∏–π –º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –≤ example.env

# üìó 2. –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞

## 2.1. –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞ –ø—Ä–∏ –ø–æ–º–æ—â–∏ –¥–æ–∫–µ—Ä–∞

```bash
docker compose up -d
```

> —Ñ–ª–∞–≥ `--build` –ø–µ—Ä–µ–±–∏–ª–¥–∏—Ç —Ç–µ–∫—É—â–∏–π –ø—Ä–æ–µ–∫—Ç

## 2.2. –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞ –≤ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏ Poetry (–±–µ–∑ Docker)

–°—Ç–∞–≤–∏–º —Ñ–ª–∞–≥ `virtualenvs.in-project`, –µ—Å–ª–∏ —Ö–æ—Ç–∏–º —Å–æ–∑–¥–∞–≤–∞—Ç—å .venv –≤  
—Ç–µ–∫—É—â–µ–π –ø–∞–ø–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞ (_–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ_)

```bash
poetry config virtualenvs.in-project true
```

- –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –æ–∫—Ä—É–∂–µ–Ω–∏–µ;

```bash
poetry shell 
```

- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏;

```bash
poetry install 
```

- –°—Ç–∞–≤–∏–º pre-commit –¥–ª—è –ª–∏–Ω—Ç–∞ –∫–æ–¥–∞;

```bash
pre-commit install
```

- –ó–∞–ø—É—Å–∫–∞–º –º–∏–≥—Ä–∞—Ü–∏–∏ `alembic` –≤–º–µ—Å—Ç–µ —Å –º–∏–≥—Ä–∞—Ü–∏–µ–π –¥–∞–Ω–Ω—ã—Ö;

```bash
make migrate_with_data
```

- –ó–∞–ø—É—Å–∫–∞–µ–º —Å—Ç–µ–∫ (PostgreSQL).

- –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

```bash
make run
```

# üìó 3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

## 3.1 –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

–û–±—ã—á–Ω—ã–π –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤:

```bash
make test
```

–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ —Å –≤–∫–ª—é—á–µ–Ω–∏–µ–º "–¥–æ–ª–≥–∏—Ö" —Ç–µ—Å—Ç–æ–≤:

```bash
make test_long
```

## 3.2 –õ–∏–Ω—Ç–µ—Ä—ã

–ó–∞–ø—É—Å–∫ –ª–∏–Ω—Ç–µ—Ä–æ–≤ –ø–æ –≤—Å–µ–º—É –ø—Ä–æ–µ–∫—Ç—É:

```bash
make lint
```

–ó–∞–ø—É—Å–∫ –ª–∏–Ω—Ç–µ—Ä–æ–≤ –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ Ruff:

```bash
ruff check --fix .
ruff format
```

## 3.3 –ú–∏–≥—Ä–∞—Ü–∏–∏

- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏

```bash
make makemigrations "migration_name"
```

- –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π

```bash
make migrate
```

- –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π –≤–º–µ—Å—Ç–µ —Å –¥–∞–Ω–Ω—ã–º–∏. –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏—è `data_upgrades()` –≤ —Ñ–∞–π–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏.

```bash
make migrate_with_data
```

- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è SQL —Ñ–∞–π–ª–∞ —Å –º–∏–≥—Ä–∞—Ü–∏—è–º–∏.

```bash
make dump_migrations
```

- –û—Ç–∫–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ `n` –≤–µ—Ä—Å–∏–π –Ω–∞–∑–∞–¥

```bash
make downgrade -n
```

# üìó 4. –ö–æ–º–∞–Ω–¥—ã Makefile

```bash 
make run # –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
make migrations_init # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω—É–ª–µ–≤–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏ –∞–ª–µ–º–±–∏–∫–∞
make makemigrations # –°–æ–∑–¥–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –∞–ª–µ–º–±–∏–∫–∞
make migrate # –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –∞–ª–µ–º–±–∏–∫–∞
make migrate_with_data # –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –∞–ª–µ–º–±–∏–∫–∞ –≤–º–µ—Å—Ç–µ —Å data –º–∏–≥—Ä–∞—Ü–∏—è–º–∏
make downgrade # –æ—Ç–∫–∞—Ç –Ω–∞ –æ–¥–Ω—É –º–∏–≥—Ä–∞—Ü–∏—é
make test_long # –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å –¥–æ–ª–≥–∏–º–∏ —Ç–µ—Å—Ç–∞–º–∏
make test # –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
make lint # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞ –ø—Ä–∏ –ø–æ–º–æ—â–∏ –ª–∏–Ω—Ç–µ—Ä–∞ Ruff
``` 

# üìó 4. Minio

### —Å–æ–∑–¥–∞—Ç—å bucket —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å –∏–º–µ–Ω–µ–º assistants
### —Å–æ–∑–¥–∞—Ç—å bucket —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å –∏–º–µ–Ω–µ–º users